import PySimpleGUI as gui
import subtitle as sub
import text_formatter as tf
import pyperclip as clipboard

layout = [
    [gui.Text('Введите ссылку на видео'),
     gui.InputText(key = 'link')],
    [gui.Button('Скачать и отформатировать субтитры', key = 'submit')],
    [gui.Multiline(size = (88, 20), key = 'output')],
    [gui.Button('Скопировать текст', key = 'copy')]
]

gui.theme('DarkAmber')
window = gui.Window('Конвертация видео в статью', layout)

def update(link):
    caption_data = sub.DownloadCaption(link)
    text = tf.TextFormater(caption_data)
    window['output'].Update(value = '')
    window['output'].print(text)

while True:
    event, values = window.read()
    print(event, values) #debug
    if event in (None, 'Exit', 'Cancel'):
        break
    if event == 'submit':
        update(values['link'])
    if event == 'copy':
        clipboard.copy(values['output'][:-1])
