from pytube import YouTube
import warnings
import os

languages = ['a.en', 'en', 'a.en-GB', 'en-GB', 'a.ru', 'ru']

def DownloadCaption(link):
    with warnings.catch_warnings():
        warnings.simplefilter("ignore")
        warnings.warn("deprecated", DeprecationWarning)
    caption = 'Субтитры отсутствуют'
    language = 'Отсутствует язык'
    
    try:
        yt = YouTube(link)
    except:
        print("Error YT link")
        return caption, '', language

    name = yt.title
    block_list = ["\\", "/", ":", "*", "?", "<", ">", "|"]
    for char in block_list:
        name = name.replace(char, '')

    print(yt.captions)
    for lang in languages:
        try:
            caption_lang = yt.captions[lang]
            caption = caption_lang.generate_srt_captions()
            language = lang
        except:
            pass
    #print(caption)
    return caption, name, language

def Caption2sbv(caption):
    result = ''
    data = caption.split('\n')
    for i in range(0, len(data)):
        if i % 4 == 1:
            result += data[i].replace(',', '.').replace(' --> ', ',') + '\n'
        elif i % 4 == 2:
            result += data[i] + '\n\n'
    return result
